<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>JAC â€” Cartas de la Suerte (3Ã—3)</title>
<style>
  :root{
    --bg1:#140824;
    --bg2:#2a0e4d;
    --bg3:#0a0418;
    --gold1:#ffe089;
    --gold2:#ffb800;
    --gold3:#8a5a00;
    --accent:#ff2bd6;
    --accent2:#7c4dff;
    --win:#00ffb7;
    --panel:#0f0825cc;
    --cardW: min(28vw, 120px);
    --gap: clamp(8px, 2.8vw, 16px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:#fff;
    background:
      radial-gradient(1200px 600px at 20% 10%, #5b2ea3 0%, transparent 60%),
      radial-gradient(1000px 800px at 80% 20%, #2e1a5b 0%, transparent 60%),
      radial-gradient(800px 600px at 50% 120%, #1b0b2e 0%, transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg3));
    overflow-x:hidden;
  }
  .wrap{
    min-height:100%;
    display:grid;
    place-items:center;
    padding:clamp(8px, 2.5vh, 24px);
    padding-bottom: calc(env(safe-area-inset-bottom, 12px) + 12px);
  }

  .machine{
    width:min(960px, 100vw);
    border-radius:20px;
    background: linear-gradient(145deg, #2a114b 0%, #0f0824 55%, #2c104e 100%);
    box-shadow: 0 8px 40px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.05);
    padding:12px;
    position:relative;
  }
  .marquee{
    margin:0 auto 10px;
    display:flex; align-items:center; gap:10px; justify-content:center;
    width:max-content;
    padding:8px 16px; border-radius:999px; 
    background: linear-gradient(145deg, #ff5ee7, #7c4dff);
    box-shadow: 0 0 22px rgba(255, 46, 230, .45), inset 0 0 10px rgba(255,255,255,.28);
    border:1.5px solid rgba(255,255,255,.18);
  }
  .marquee h1{
    margin:0; letter-spacing:.04em;
    font-weight:900; 
    font-size: clamp(16px, 5vw, 28px);
    text-transform:uppercase;
    text-shadow: 0 2px 12px rgba(0,0,0,.6);
    white-space:nowrap;
  }
  .glow-dot{
    width:9px; height:9px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #fff, #ffe, #ff2bd6);
    box-shadow: 0 0 14px #ff2bd6, 0 0 22px #ff2bd6;
    animation: pulse 1.2s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100%{ transform:scale(.9) } 50%{ transform:scale(1.13) } }

  .hud{
    display:grid; 
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap:8px;
    margin:6px 0 12px;
  }
  .chip{
    background: var(--panel);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:10px 12px;
    font-weight:800; letter-spacing:.02em;
    display:flex; align-items:center; gap:10px; justify-content:center;
    min-height:42px;
  }
  .chip strong{ color: var(--gold1); text-shadow: 0 0 8px rgba(255,184,0,.35) }
  .chip .led{ width:10px; height:10px; border-radius:50%;
    box-shadow: 0 0 10px currentColor, 0 0 18px currentColor; }

  /* GRID 3x3 */
  .board-wrap{
    display:grid; place-items:center;
  }
  .board{
    display:grid;
    grid-template-columns: repeat(3, var(--cardW));
    gap: var(--gap);
    justify-content:center;
  }
  @media (min-width:760px){
    :root{ --cardW: min(18vw, 140px) }
  }

  /* CARD */
  .card{
    width:var(--cardW); height:var(--cardW);
    perspective: 1000px;
  }
  .card-inner{
    position:relative; width:100%; height:100%;
    transform-style: preserve-3d;
    transition: transform 480ms cubic-bezier(.17,.97,.3,1);
  }
  .card.flipped .card-inner{ transform: rotateY(180deg); }
  .face{
    position:absolute; inset:0; display:grid; place-items:center;
    backface-visibility: hidden;
    border-radius:16px;
  }
  .front{
    transform: rotateY(180deg);
    background:
      radial-gradient(120% 90% at 50% 10%, rgba(255,255,255,.08), transparent 45%),
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.2));
    box-shadow: 0 8px 24px rgba(0,0,0,.5), inset 0 0 0 2px rgba(255,255,255,.06);
  }
  .back{
    background: linear-gradient(145deg, #ffe478, #ffb800 40%, #e18c00 80%);
    box-shadow: 0 10px 28px rgba(0,0,0,.5), inset 0 0 0 2px rgba(255,255,255,.35);
    position:relative; overflow:hidden;
  }
  .back::after{
    content:""; position:absolute; inset:-30% -30% auto auto;
    width:160%; height:160%;
    background: radial-gradient(60% 60% at 70% 30%, rgba(255,255,255,.35), transparent 60%);
    transform: rotate(25deg);
  }
  .card svg{ filter: drop-shadow(0 3px 6px rgba(0,0,0,.4)); }

  /* BUTTONS */
  .controls{
    display:flex; gap:12px; justify-content:center; align-items:center;
    margin:14px 0 6px;
  }
  .btn{
    appearance:none; border:0; cursor:pointer;
    font-weight:900; letter-spacing:.06em; text-transform:uppercase;
    border-radius:18px; padding:14px 22px;
    font-size:clamp(14px, 4.6vw, 18px);
    color:#2d0a23;
    background: linear-gradient(145deg, #ffe478, #ffb800 40%, #e18c00 80%);
    box-shadow: 0 12px 32px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.35);
    transition: transform .06s ease, filter .06s ease;
    min-width:min(60vw, 320px);
  }
  .btn:active{ transform: translateY(1px) scale(.99) }
  .btn[disabled]{ filter:grayscale(.7) brightness(.85); cursor:not-allowed; }

  /* TOAST */
  .toast{
    position: fixed; left:50%; bottom: max(12px, env(safe-area-inset-bottom, 12px));
    transform:translateX(-50%) translateY(20px);
    background: rgba(0,0,0,.7);
    border:1px solid rgba(255,255,255,.07);
    border-radius:14px; padding:12px 16px; opacity:0;
    transition: all .35s ease; pointer-events:none;
    font-weight:700;
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }

  /* POPUP */
  .overlay{
    position:fixed; inset:0; display:grid; place-items:center;
    background: radial-gradient(120% 120% at 50% 30%, rgba(10,4,24,.8), rgba(7,3,18,.9));
    backdrop-filter: blur(6px);
    opacity:0; pointer-events:none; transition: opacity .3s ease;
    z-index:50;
  }
  .overlay.show{ opacity:1; pointer-events:auto; }
  .card-end{
    background: linear-gradient(145deg, #2a114b 0%, #0f0824 55%, #2c104e 100%);
    border:1px solid rgba(255,255,255,.12);
    border-radius:22px; padding:24px; text-align:center;
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    max-width:min(92vw, 520px);
  }
  .card-end h2{ margin:0 0 8px; font-size:clamp(20px, 6vw, 28px); }
  .card-end p{ margin:0 0 14px; opacity:.9 }
  .hint{ font-size:.9rem; opacity:.8 }
  .badge{
    display:inline-block; padding:6px 10px; border-radius:999px; font-weight:900; letter-spacing:.04em;
    background: linear-gradient(145deg, #ffe478, #ffb800 40%, #e18c00 80%);
    color:#2d0a23; box-shadow: 0 6px 18px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.35);
  }

  /* SVG defs shared */
  svg defs linearGradient stop{ transition: none !important; }
  .g-stroke{ stroke:url(#goldStroke); stroke-width:2; }
  .shine{ filter:url(#specShine); }
</style>
</head>
<body>
  <div class="wrap">
    <div class="machine">
      <div class="marquee">
        <span class="glow-dot"></span>
        <h1>Cartas de la Suerte â€” JAC</h1>
        <span class="glow-dot"></span>
      </div>

      <div class="hud">
        <div class="chip"><span class="led" id="led" style="color:#36f"></span><strong id="state">Elige 3 cartas</strong></div>
        <div class="chip"><strong>Intentos:</strong> <span id="tries">3</span></div>
        <div class="chip"><strong>Mejor premio:</strong> <span id="best">â€”</span></div>
      </div>

      <div class="board-wrap">
        <div class="board" id="board">
          <!-- 9 cards -->
        </div>
      </div>

      <div class="controls">
        <button class="btn" id="againBtn" style="display:none">Jugar de nuevo</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Mensaje</div>

  <!-- POPUP -->
  <div class="overlay" id="overlay">
    <div class="card-end">
      <div class="badge" id="popBadge">Â¡Premio!</div>
      <h2 id="popTitle">Â¡Ganaste!</h2>
      <p id="popText">Has logrado 3 cerezas.</p>
      <div class="hint">Toca fuera para cerrar.</div>
    </div>
  </div>

  <!-- SVG ICONS -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <linearGradient id="goldStroke" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#fff3b0"/>
        <stop offset="50%" stop-color="#ffcc4d"/>
        <stop offset="100%" stop-color="#b88700"/>
      </linearGradient>
      <radialGradient id="specWhite" cx="30%" cy="30%" r="70%">
        <stop offset="0%" stop-color="#ffffff" stop-opacity=".95"/>
        <stop offset="60%" stop-color="#ffffff" stop-opacity=".2"/>
        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
      </radialGradient>
      <filter id="specShine" x="-30%" y="-30%" width="160%" height="160%">
        <feGaussianBlur stdDeviation="0.4" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
      <!-- CHERRY -->
      <g id="ico-cherry">
        <circle cx="16" cy="22" r="10" fill="#ff2f58" class="g-stroke shine"/>
        <circle cx="28" cy="20" r="10" fill="#ff5a7a" class="g-stroke shine"/>
        <ellipse cx="14" cy="18" rx="4" ry="3" fill="url(#specWhite)"/>
        <ellipse cx="26" cy="16" rx="4" ry="3" fill="url(#specWhite)"/>
        <path d="M14 10 C16 2, 22 2, 24 10" stroke="#44d17a" stroke-width="3" fill="none" />
        <path d="M24 10 C30 6, 34 8, 36 10" stroke="#44d17a" stroke-width="3" fill="none" />
        <circle cx="21" cy="19" r="2" fill="#fff9"/>
      </g>
      <!-- STAR -->
      <g id="ico-star">
        <polygon points="22,4 27,17 40,17 30,25 34,38 22,30 10,38 14,25 4,17 17,17"
          fill="#ffd94d" class="g-stroke shine"/>
        <ellipse cx="22" cy="12" rx="8" ry="5" fill="url(#specWhite)"/>
      </g>
      <!-- LEMON -->
      <g id="ico-lemon">
        <ellipse cx="22" cy="20" rx="16" ry="12" fill="#ffe055" class="g-stroke shine"/>
        <ellipse cx="30" cy="18" rx="5" ry="4" fill="url(#specWhite)"/>
        <path d="M7 20 Q22 5, 37 20 Q22 35, 7 20" fill="none" stroke="#fff6" stroke-width="1.5"/>
      </g>
      <!-- DIAMOND -->
      <g id="ico-diamond">
        <polygon points="22,6 36,16 22,36 8,16" fill="#9be8ff" class="g-stroke shine"/>
        <polyline points="22,6 28,16 22,36 16,16 22,6" fill="none" stroke="#fff8" stroke-width="1.5"/>
        <ellipse cx="22" cy="12" rx="8" ry="5" fill="url(#specWhite)"/>
      </g>
      <!-- BAR -->
      <g id="ico-bar">
        <rect x="4" y="10" width="36" height="18" rx="3" fill="#1c0f2f" class="g-stroke"/>
        <text x="22" y="24" text-anchor="middle" font-weight="900" font-size="12" fill="#fff">BAR</text>
        <rect x="6" y="12" width="12" height="3" fill="url(#specWhite)" opacity=".6"/>
      </g>
    </defs>
  </svg>

<script>
(function(){
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => [...ctx.querySelectorAll(sel)];
  const rand = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
  const choice = arr => arr[rand(0,arr.length-1)];

  const boardEl = $('#board');
  const triesEl = $('#tries');
  const stateEl = $('#state');
  const bestEl = $('#best');
  const againBtn = $('#againBtn');
  const overlayEl = $('#overlay');
  const popBadge = $('#popBadge');
  const popTitle = $('#popTitle');
  const popText = $('#popText');
  const toastEl = $('#toast');

  const SYMBOLS = ['cherry','star','lemon','diamond','bar'];
  // weights for random generation (cherry >> star)
  const WEIGHTS = { cherry: 48, star: 12, lemon: 18, diamond: 12, bar: 10 };

  const MAX_TRIES = 3;
  let tries = MAX_TRIES;
  let picks = [];      // revealed ids
  let revealedIdx = new Set();
  let best = 'â€”';

  init();

  function init(){
    tries = MAX_TRIES;
    picks = [];
    revealedIdx = new Set();
    best = 'â€”';
    triesEl.textContent = String(tries);
    bestEl.textContent = best;
    stateEl.textContent = 'Elige 3 cartas';

    boardEl.innerHTML = '';
    const deck = generateBoard(); // 9 symbols
    deck.forEach((id, i) => {
      const card = createCard(id, i);
      boardEl.appendChild(card);
    });
    againBtn.style.display = 'none';
  }

  function generateBoard(){
    // Two modes: jackpot-possible (20%) includes exactly 3 stars, otherwise 1â€“2 stars
    const jackpotPossible = Math.random() < 0.20;
    let stars = jackpotPossible ? 3 : rand(1,2);

    // Ensure cherries are abundant: between 4â€“6 cherries, but keep total 9.
    let cherries = rand(4,6);

    // If stars=3 and cherries=6 would exceed 9, reduce cherries
    if (cherries + stars > 9) cherries = 9 - stars - rand(0,2);

    // Fill others
    const othersSlots = 9 - (stars + cherries);
    const othersPool = weightedArray(['lemon','diamond','bar'], [18,12,10], othersSlots);

    const arr = [];
    for (let i=0;i<cherries;i++) arr.push('cherry');
    for (let i=0;i<stars;i++) arr.push('star');
    arr.push(...othersPool);

    // Shuffle
    for (let i=arr.length-1;i>0;i--){
      const j = rand(0,i);
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function weightedArray(items, weights, count){
    // sample with replacement by weight
    const pool = [];
    const sum = weights.reduce((a,b)=>a+b,0);
    for (let k=0;k<count;k++){
      let r = Math.random()*sum, idx=0;
      for (let i=0;i<items.length;i++){
        r -= weights[i];
        if (r<=0){ idx=i; break; }
      }
      pool.push(items[idx]);
    }
    return pool;
  }

  function createCard(symbolId, idx){
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.index = idx;
    card.dataset.symbol = symbolId;
    card.innerHTML = `
      <div class="card-inner">
        <div class="face front">${svgIcon(symbolId)}</div>
        <div class="face back"></div>
      </div>
    `;
    card.addEventListener('click', ()=> onFlip(card));
    return card;
  }

  function svgIcon(id){
    return `<svg viewBox="0 0 44 44" width="64" height="64"><use href="#ico-${id}"></use></svg>`;
  }

  function onFlip(card){
    const idx = Number(card.dataset.index);
    if (tries<=0 || revealedIdx.has(idx)) return;
    card.classList.add('flipped');
    revealedIdx.add(idx);
    picks.push(card.dataset.symbol);
    tries--;
    triesEl.textContent = String(tries);
    stateEl.textContent = tries>0 ? `Te quedan ${tries} ${tries===1?'intento':'intentos'}` : 'Sin intentos';

    // haptic (best effort)
    if (navigator.vibrate) navigator.vibrate(12);

    evaluateProgress();

    if (tries === 0){
      endRound();
    }
  }

  function evaluateProgress(){
    const count = (sym)=> picks.filter(x=>x===sym).length;
    const cCherry = count('cherry');
    const cStar = count('star');
    if (cCherry>=3){ best='Premio'; bestEl.textContent = 'Premio (3 cerezas)'; }
    if (cStar>=3){ best='PREMIO MAYOR'; bestEl.textContent = 'PREMIO MAYOR (3 estrellas)'; }
  }

  function endRound(){
    // Disable further flips
    $$('.card').forEach(c => c.style.pointerEvents='none');
    againBtn.style.display = 'inline-block';
    const cCherry = picks.filter(x=>x==='cherry').length;
    const cStar = picks.filter(x=>x==='star').length;

    if (cStar>=3){
      popup('Â¡PREMIO MAYOR!', 'Has encontrado 3 estrellas. ðŸŽ‰', true);
    } else if (cCherry>=3){
      popup('Â¡Premio!', 'Has encontrado 3 cerezas. ðŸ’', false);
    } else {
      toast('No hay premio esta vez. Intenta de nuevo.');
    }
  }

  function popup(title, text, isJackpot){
    popTitle.textContent = title;
    popText.textContent = text;
    popBadge.textContent = isJackpot ? 'PREMIO MAYOR' : 'PREMIO';
    overlayEl.classList.add('show');
    // subtle longer vibration
    if (navigator.vibrate) navigator.vibrate([16, 40, 16]);
  }

  overlayEl.addEventListener('click', ()=> overlayEl.classList.remove('show'));
  againBtn.addEventListener('click', init);

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(toast._t);
    toast._t = setTimeout(()=> toastEl.classList.remove('show'), 2000);
  }

})();</script>
</body>
</html>
